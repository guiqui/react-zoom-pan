(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{311:function(module,__webpack_exports__,__webpack_require__){"use strict";var extendStatics,react=__webpack_require__(3),react_default=__webpack_require__.n(react),ObjectTypes_TYPE_ITEM=0,ObjectTypes_TYPE_LINK=1,ViewPortConst={MODE_GLOBAL_PAN:1,MODE_RUBER_BAND_MOVE:2,MODE_RUBER_BAND_ROTATE:3,MODE_RUBER_BAND_RESIZE_UL:4,MODE_RUBER_BAND_RESIZE_UR:5,MODE_RUBER_BAND_RESIZE_DL:6,MODE_RUBER_BAND_RESIZE_DR:7,MODE_RUBER_PADDING:8,MODE_RUBER_ADD_LINK_LEFT:9,MODE_RUBER_ADD_LINK_RIGHT:10,MODE_PAGE_MOVE:11,CLOCKWISE:22,UNCLOCKWISE:23,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_COPY:67,KEY_CUT:88,KEY_PASTE:86,KEY_DELETE:46,RUBBER_BAND_HANDLE_SIZE:5,RUBBER_BAND_EVENT_HANDLE_SIZE:10,RUBBER_BAND_EVENT_HANDLE_SIZE_HALF:5},helpers_Matrix=function(){function Matrix(data){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this.apply(data)}return Matrix.prototype.apply=function(data){var values=[1,0,0,1,0,0];data&&(values=data.split(",")),this.a=parseFloat(values[0]),this.b=parseFloat(values[1]),this.c=parseFloat(values[2]),this.d=parseFloat(values[3]),this.e=parseFloat(values[4]),this.f=parseFloat(values[5]),this.transform=this.transform.bind(this),this.rotate=this.rotate.bind(this),this.applyToPoint=this.applyToPoint.bind(this),this._isEqual=this._isEqual.bind(this)},Matrix.prototype.flipX=function(){return this.transform(-1,0,0,1,0,0)},Matrix.prototype.flipY=function(){return this.transform(1,0,0,-1,0,0)},Matrix.prototype.reset=function(){return this.a=this.d=1,this.b=this.c=this.e=this.f=0,this},Matrix.prototype.rotate=function(angle){var cos=Math.cos(.017453292519943295*angle),sin=Math.sin(.017453292519943295*angle);return this.transform(cos,sin,-sin,cos,0,0)},Matrix.prototype.rotateDeg=function(angle){return this.rotate(.017453292519943295*angle)},Matrix.prototype.scale=function(sx,sy){return this.transform(sx,0,0,sy,0,0)},Matrix.prototype.scaleX=function(sx){return this.transform(sx,0,0,1,0,0)},Matrix.prototype.scaleY=function(sy){return this.transform(1,0,0,sy,0,0)},Matrix.prototype.skew=function(sx,sy){return this.transform(1,sy,sx,1,0,0)},Matrix.prototype.skewX=function(sx){return this.transform(1,0,sx,1,0,0)},Matrix.prototype.skewY=function(sy){return this.transform(1,sy,0,1,0,0)},Matrix.prototype.setTransform=function(a,b,c,d,e,f){return this.a=a,this.b=b,this.c=c,this.d=d,this.e=e,this.f=f,this},Matrix.prototype.translate=function(tx,ty){return this.transform(1,0,0,1,tx,ty)},Matrix.prototype.transform=function(a2,b2,c2,d2,e2,f2){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,e1=this.e,f1=this.f,result=new Matrix;return result.a=a1*a2+c1*b2,result.b=b1*a2+d1*b2,result.c=a1*c2+c1*d2,result.d=b1*c2+d1*d2,result.e=a1*e2+c1*f2+e1,result.f=b1*e2+d1*f2+f1,result},Matrix.prototype.multiply=function(matrix){var result=new Matrix,a1=this.a,b1=this.b,c1=this.c,d1=this.d,e1=this.e,f1=this.f;return result.a=a1*matrix.a+c1*matrix.b,result.b=b1*matrix.a+d1*matrix.b,result.c=a1*matrix.c+c1*matrix.d,result.d=b1*matrix.c+d1*matrix.d,result.e=a1*matrix.e+c1*matrix.f+e1,result.f=b1*matrix.e+d1*matrix.f+f1,result},Matrix.prototype.inverse=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.e,f=this.f,m=new Matrix,dt=a*d-b*c;return m.a=d/dt,m.b=-b/dt,m.c=-c/dt,m.d=a/dt,m.e=(c*f-d*e)/dt,m.f=-(a*f-b*e)/dt,m},Matrix.prototype.interpolate=function(m2,t){var m=new Matrix;return m.a=this.a+(m2.a-this.a)*t,m.b=this.b+(m2.b-this.b)*t,m.c=this.c+(m2.c-this.c)*t,m.d=this.d+(m2.d-this.d)*t,m.e=this.e+(m2.e-this.e)*t,m.f=this.f+(m2.f-this.f)*t,m},Matrix.prototype.applyToPoint=function(x,y){return{x:x*this.a+y*this.c+this.e,y:x*this.b+y*this.d+this.f}},Matrix.prototype.applyToArray=function(points){var p,l,i=0,mxPoints=[];if("number"==typeof points[0])for(l=points.length;i<l;)p=this.applyToPoint(points[i++],points[i++]),mxPoints.push(p.x,p.y);else for(;p=points[i];i++)mxPoints.push(this.applyToPoint(p.x,p.y));return mxPoints},Matrix.prototype.applyToTypedArray=function(points){for(var p,i=0,l=points.length,mxPoints=new Float32Array(l);i<l;)p=this.applyToPoint(points[i],points[i+1]),mxPoints[i++]=p.x,mxPoints[i++]=p.y;return mxPoints},Matrix.prototype.isIdentity=function(){return this._isEqual(this.a,1)&&this._isEqual(this.b,0)&&this._isEqual(this.c,0)&&this._isEqual(this.d,1)&&this._isEqual(this.e,0)&&this._isEqual(this.f,0)},Matrix.prototype.isEqual=function(m){return this._isEqual(this.a,m.a)&&this._isEqual(this.b,m.b)&&this._isEqual(this.c,m.c)&&this._isEqual(this.d,m.d)&&this._isEqual(this.e,m.e)&&this._isEqual(this.f,m.f)},Matrix.prototype._isEqual=function(f1,f2){return Math.abs(f1-f2)<1e-14},Matrix.prototype.matrixToText=function(){return this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f},Object.defineProperty(Matrix.prototype,"trx",{get:function(){return this.e},set:function(value){this.e=value},enumerable:!0,configurable:!0}),Object.defineProperty(Matrix.prototype,"try",{get:function(){return this.f},set:function(value){this.f=value},enumerable:!0,configurable:!0}),Matrix}(),helpers_Point=function(){function Point(x,y){this.x=0,this.y=0,this.matrixTransform=this.matrixTransform.bind(this),this.x=x,this.y=y}return Point.prototype.matrixTransform=function(matrix){var x=this.x,y=this.y;this.x=x*matrix.a+y*matrix.c+matrix.e,this.y=x*matrix.b+y*matrix.d+matrix.f},Point}(),registry_Registry=new(function(){function Registry(){var _this=this;this.addAll=function(list){list&&(_this.data={},list.forEach((function(element){_this.data[element.id]=element})))},this.data={}}return Registry.prototype.add=function(id,obj){this.data[id]=obj},Registry.prototype.del=function(id){delete this.data[id]},Registry.prototype.get=function(id){return this.data[id]},Registry.prototype.delAll=function(){this.data={}},Registry}()),radiansFactor=180/Math.PI,helpers_SpacialHelper=function(){function SpacialHelper(){}return SpacialHelper.normaliseVector=function(vector){return Math.abs(vector.x)>Math.abs(vector.y)?vector.x>0?{x:1,y:0}:{x:-1,y:0}:vector.y>0?{x:0,y:1}:{x:0,y:-1}},SpacialHelper.calculateDistance=function(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2))},SpacialHelper.calculateRotationsAngle=function(p1,center,p2){var p1Center=SpacialHelper.calculateDistance(p1,center),p2Center=SpacialHelper.calculateDistance(p2,center),p1p2=SpacialHelper.calculateDistance(p1,p2),enu=Math.pow(p1Center,2)+Math.pow(p2Center,2)-Math.pow(p1p2,2),deno=2*p1Center*p2Center;return Math.acos(enu/deno)*radiansFactor},SpacialHelper.getParentMatrix=function(id,combine){var parentId=registry_Registry.get(id).parent;if(!parentId)return combine;var parentMtx=registry_Registry.get(parentId).matrix;return combine=combine?combine.multiply(parentMtx):parentMtx,SpacialHelper.getParentMatrix(parentId,combine)},SpacialHelper.getCombineMatrix=function(id){var combine=new helpers_Matrix(registry_Registry.get(id).transform),parentMtx=SpacialHelper.getParentMatrix(id,combine);return parentMtx||combine},SpacialHelper.degrees=function(radians){return radians*radiansFactor},SpacialHelper.rotateToCenter=function(cx,cy,angle,matrix){return 0!=angle&&matrix?matrix=(matrix=(matrix=matrix.translate(cx,cy)).rotate(angle)).translate(-cx,-cy):matrix},SpacialHelper.scaleToCenter=function(cx,cy,scale,matrix){return 0!=scale&&matrix?matrix=(matrix=(matrix=matrix.translate(cx,cy)).scale(scale,scale)).translate(-cx,-cy):matrix},SpacialHelper.getRotationDirection=function(p1,p2,center){var vector={x:p2.x-p1.x,y:p2.y-p1.y};return 0===(vector=SpacialHelper.normaliseVector(vector)).y?p1.y-center.y<0?vector.x>0?ViewPortConst.CLOCKWISE:ViewPortConst.UNCLOCKWISE:vector.x<0?ViewPortConst.CLOCKWISE:ViewPortConst.UNCLOCKWISE:p1.x-center.x>0?vector.y>0?ViewPortConst.CLOCKWISE:ViewPortConst.UNCLOCKWISE:vector.y<0?ViewPortConst.CLOCKWISE:ViewPortConst.UNCLOCKWISE},SpacialHelper.transfromIncrement=function(dx,dy,global,selectedObjMatrix){var matrix=global;matrix=global?matrix.multiply(selectedObjMatrix):selectedObjMatrix;var pts=new helpers_Point(0,0),pte=new helpers_Point(dx,dy),inverse=matrix.inverse();return pts.matrixTransform(inverse),pte.matrixTransform(inverse),{dx:pte.x-pts.x,dy:pte.y-pts.y}},SpacialHelper.coordinatesGlobalToLocal=function(x,y,global,parent){var pts=new helpers_Point(x,y);return global&&pts.matrixTransform(global.inverse()),parent&&pts.matrixTransform(parent.inverse()),pts},SpacialHelper.transformToViewPort=function(x,y,globalM,itemM,parent){var pts=new helpers_Point(x,y);if(!globalM||!itemM)return pts;parent&&(globalM=globalM.multiply(parent));var matrix=globalM.multiply(itemM);return pts.matrixTransform(matrix),pts},SpacialHelper.viewPorttoObject=function(x,y,globalM,parent){var itemMatrix=new helpers_Matrix;itemMatrix.translate(x,y);var contextMatrix=globalM||itemMatrix;return parent&&(contextMatrix=contextMatrix.multiply(parent)),contextMatrix=contextMatrix.inverse(),itemMatrix.multiply(contextMatrix)},SpacialHelper.calculateRubberBandPosition=function(selectedMatrix,selectedBox,globalMatrix,parentMatrix){if(!selectedMatrix)return{x:0,y:0,w:0,h:0,transform:0};var box=selectedBox,matrix=selectedMatrix;(box=this.calculateTrasformBox(box,globalMatrix,matrix,parentMatrix)).x=box.x-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,box.y=box.y-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,box.w=box.w+2*ViewPortConst.RUBBER_BAND_HANDLE_SIZE,box.h=box.h+2*ViewPortConst.RUBBER_BAND_HANDLE_SIZE;var rubberMatrix=new helpers_Matrix,cx=box.x+box.w/2,cy=box.y+box.h/2;return rubberMatrix=SpacialHelper.rotateToCenter(cx,cy,box.angle,rubberMatrix),{x:box.x,y:box.y,w:box.w,h:box.h,transform:rubberMatrix.matrixToText()}},SpacialHelper.calculateTrasformBox=function(box,globalM,itemM,parentMatrix){var angle=0;0!=itemM.b&&(angle=SpacialHelper.degrees(Math.atan2(itemM.b,itemM.a))),parentMatrix&&(globalM=globalM.multiply(parentMatrix));var cx=box.w/2,cy=box.h/2;itemM=SpacialHelper.rotateToCenter(cx,cy,-angle,itemM);var matrix=globalM.multiply(itemM),pts=new helpers_Point(0,0),pte=new helpers_Point(box.w,box.h);return pts.matrixTransform(matrix),pte.matrixTransform(matrix),pte.x=pte.x-pts.x,pte.y=pte.y-pts.y,{x:pts.x,y:pts.y,w:pte.x,h:pte.y,angle:angle}},SpacialHelper.moveObject=function(dx,dy,state){var increment=SpacialHelper.transfromIncrement(dx,dy,state.viewportMtx,state.selection.matrix),objMatrix=state.selection.matrix;return{matrix:objMatrix=objMatrix.translate(-increment.dx,-increment.dy),box:null}},SpacialHelper.checkConstrains=function(objbox,matrix,parentbox){if(!parentbox)return!0;var ptl=new helpers_Point(0,0),ptr=new helpers_Point(objbox.w,0),pbl=new helpers_Point(0,objbox.h),pbr=new helpers_Point(objbox.w,objbox.h);return ptl.matrixTransform(matrix),!!SpacialHelper.isPointInBox(ptl,parentbox)&&(ptr.matrixTransform(matrix),!!SpacialHelper.isPointInBox(ptr,parentbox)&&(pbl.matrixTransform(matrix),!!SpacialHelper.isPointInBox(pbl,parentbox)&&(pbr.matrixTransform(matrix),!!SpacialHelper.isPointInBox(pbr,parentbox))))},SpacialHelper.isPointInBox=function(point,box){return!(point.x<0||point.y<0)&&!(point.x>box.w||point.y>box.h)},SpacialHelper.rotateObject=function(x,y,lastx,lasty,state){var box=state.box,cx=box.x+box.w/2,cy=box.y+box.h/2,p1={x:lastx,y:lasty},p2={x:x,y:y},center=SpacialHelper.transformToViewPort(cx,cy,state.viewportMtx,state.selection.matrix,state.parentMtx);console.log("rotating cx:"+center.x+" cy:"+center.y+"   x:"+x+" y:"+y+" ");var direction=SpacialHelper.getRotationDirection(p1,p2,center),angle=SpacialHelper.calculateRotationsAngle(p1,center,p2);angle=direction==ViewPortConst.CLOCKWISE?angle:-angle;var objMatrix=state.selection.matrix;return{matrix:objMatrix=(objMatrix=(objMatrix=objMatrix.translate(cx,cy)).rotate(angle)).translate(-cx,-cy),box:null}},SpacialHelper.scaleObject=function(dx,dy,right,state){var box=state.box,cx=box.x+box.w/2,cy=box.y+box.h/2;right||(dx=-dx,dy=-dy);var increment=SpacialHelper.transfromIncrement(dx,dy,state.viewportMtx,state.selection.matrix),oldpoint=SpacialHelper.transfromIncrement(box.x+box.w-cx,box.y+box.h-cy,state.viewportMtx,state.selection.matrix),newpoint=SpacialHelper.transfromIncrement(box.x+box.w-increment.dx-cx,box.y+box.h-increment.dy-cy,state.viewportMtx,state.selection.matrix);if(!(box.x+box.w-increment.dx<cx||box.y+box.h-increment.dy<cy)){var ix=newpoint.dx/oldpoint.dx,iy=newpoint.dy/oldpoint.dy,objMatrix=state.selection.matrix;return{matrix:objMatrix=(objMatrix=(objMatrix=objMatrix.translate(cx,cy)).scale(ix,iy)).translate(-cx,-cy),box:null}}},SpacialHelper.resizeObject=function(dx,dy,side,state){var box=state.selection.box,ix=0,iy=0,increment=SpacialHelper.transfromIncrement(dx,dy,state.viewportMtx,state.selection.matrix),fdx=0,fdy=0,objMatrix=state.selection.matrix;switch(side){case ViewPortConst.MODE_RUBER_BAND_RESIZE_UL:ix=-increment.dx,iy=-increment.dy,fdx=increment.dx,fdy=increment.dy;break;case ViewPortConst.MODE_RUBER_BAND_RESIZE_UR:iy=-increment.dy,fdx=-increment.dx,fdy=increment.dy;break;case ViewPortConst.MODE_RUBER_BAND_RESIZE_DL:ix=-increment.dx,fdx=increment.dx,fdy=-increment.dy;break;case ViewPortConst.MODE_RUBER_BAND_RESIZE_DR:fdx=-increment.dx,fdy=-increment.dy}var objBox={x:0,y:0,w:box.w+fdx,h:box.h+fdy};return{matrix:objMatrix=objMatrix.translate(ix,iy),box:objBox}},SpacialHelper}(),__extends=(__webpack_require__(712),extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),ZoomPan_rubberBand_RubberBand=function(_super){function RubberBand(props){var _this=_super.call(this,props)||this;return _this.calculateCoordinates=_this.calculateCoordinates.bind(_this),_this}return __extends(RubberBand,_super),RubberBand.prototype.shouldComponentUpdate=function(nextProps,nextState){return nextProps.selectedItem||nextProps.viewport.viewportTr!==this.props.viewport.viewportTr||nextProps.viewport.selectedTr!==this.props.viewport.viewportTr||nextProps.viewport.parentTr!==this.props.viewport.viewportTr},RubberBand.prototype.calculateCoordinates=function(){var box=helpers_SpacialHelper.calculateRubberBandPosition(this.props.viewport.selection.matrix,this.props.viewport.selection.box,this.props.viewport.viewportMtx,null);return{x:box.x,y:box.y,w:box.w,h:box.h,transform:box.transform}},RubberBand.prototype.render=function(){var _this=this,coordinates=this.calculateCoordinates();return this.props.selection?react_default.a.createElement("svg",{id:"Rubberband",className:"rubberBand-Container",width:"100%",height:"100%",onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_MOVE)}},react_default.a.createElement("g",{transform:"matrix("+coordinates.transform+")"},react_default.a.createElement("rect",{ref:"ruberBandRect",className:"rubberBand",x:coordinates.x,y:coordinates.y,width:coordinates.w,height:coordinates.h}),react_default.a.createElement("rect",{ref:"ruberBandTopLeft",className:"rubberBandHandle",x:coordinates.x-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,y:coordinates.y-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,width:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,height:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_RESIZE_UL)}}),react_default.a.createElement("rect",{ref:"ruberBandTopRight",className:"rubberBandHandle",x:coordinates.x+coordinates.w,y:coordinates.y-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,width:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,height:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_RESIZE_UR)}}),react_default.a.createElement("rect",{ref:"ruberBandBottomLeft",className:"rubberBandHandle",x:coordinates.x-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,y:coordinates.y+coordinates.h,width:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,height:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_RESIZE_DL)}}),react_default.a.createElement("rect",{ref:"ruberBandBottomRight",className:"rubberBandHandle",x:coordinates.x+coordinates.w,y:coordinates.y+coordinates.h,width:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,height:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_RESIZE_DR)}}),react_default.a.createElement("rect",{ref:"ruberBandBottomLeft",className:"rubberBandHandle",x:coordinates.x+coordinates.w/2-ViewPortConst.RUBBER_BAND_HANDLE_SIZE,y:coordinates.y+1.5*coordinates.h,width:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,height:ViewPortConst.RUBBER_BAND_HANDLE_SIZE,onMouseDown:function(event){_this.props.doRubberMouseDown(event,ViewPortConst.MODE_RUBER_BAND_ROTATE)}}))):null},RubberBand}(react.Component),helpers_ZoomPanHelper=function(){function ZoomPanHelper(){}return ZoomPanHelper.prototype.pan=function(dx,dy,transformMatrix){transformMatrix.e-=dx,transformMatrix.f-=dy},ZoomPanHelper.prototype.zoom=function(scale,cx,cy,transformMatrix){transformMatrix.e-=cx,transformMatrix.f-=cy,transformMatrix.a*=scale,transformMatrix.b*=scale,transformMatrix.c*=scale,transformMatrix.d*=scale,transformMatrix.e*=scale,transformMatrix.f*=scale,transformMatrix.e+=cx,transformMatrix.f+=cy},ZoomPanHelper}(),HOCElement_extends=function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),HOCElement_ViewPortElement=function(_super){function ViewPortElement(props){var _this=_super.call(this,props)||this;_this.x=0,_this.y=0,_this.w=100,_this.h=100,_this.transform="1,0,0,1,0,0",_this.id="";var propsChildren=props.children?props.children.props:null,x=propsChildren.x,y=propsChildren.y,w=propsChildren.w,h=propsChildren.h;return _this.x=x||0,_this.y=y||0,_this.w=w||100,_this.h=h||100,_this.transform="1,0,0,1,"+_this.x+","+_this.y,_this.id=props.id,_this}return HOCElement_extends(ViewPortElement,_super),ViewPortElement.prototype.render=function(){var _this=this,_a=this.props,transform=_a.transform,children=_a.children,box=_a.box;return this.transform=transform||this.transform,box&&(this.w=box.w,this.h=box.h),console.log(this.transform),react_default.a.createElement("div",{id:""+this.props.id,style:{overflow:"hidden",transformOrigin:"0% 0%",top:0,left:0,height:this.h,width:this.w,position:"absolute",transform:"matrix("+this.transform+")"},onMouseDown:function(e){return _this.props.doObjectMouseDown(e,null,_this)}},children)},ViewPortElement}(react_default.a.PureComponent),ZoomPan_extends=(__webpack_require__(714),function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},ZoomPan_ZoomPan_ZoomPan=function(_super){function ZoomPan(props){var _this=_super.call(this,props)||this;return _this.selection=null,_this.draggingPositionX=0,_this.draggingPositionY=0,_this.mode=ViewPortConst.MODE_GLOBAL_PAN,_this.addRemoveMouseListener=function(newState,oldState){newState.dragging&&!oldState.dragging?(document.addEventListener("mousemove",_this.doMouseMove),document.addEventListener("mouseup",_this.doMouseUp)):!newState.dragging&&oldState.dragging&&(document.removeEventListener("mousemove",_this.doMouseMove),document.removeEventListener("mouseup",_this.doMouseUp))},_this.getSelectedObjInfo=function(item){var matrix=item?new helpers_Matrix(item.transform):new helpers_Matrix,box=item?{id:item.id,x:0,y:0,w:item.w,h:item.h}:{id:"",x:0,y:0,w:0,h:0},type=item?_this.getObjType(item):ObjectTypes_TYPE_ITEM;return{id:item?item.id:-1,item:item,matrix:matrix,transform:matrix.matrixToText(),box:box,type:type}},_this.doGlobalMouseDown=function(e){0===e.button&&(_this.setDraggingPosition(e),_this.setState({dragging:!0}),_this.mode=ViewPortConst.MODE_GLOBAL_PAN)},_this.doObjectMouseDown=function(e,parent,item){e.stopPropagation(),_this.setDraggingPosition(e),_this.setState({dragging:!0}),_this.props.onSelectItem&&_this.props.onSelectItem(parent,item),_this.selection=item;var selection=_this.getSelectedObjInfo(item);_this.setState({dragging:!0,selection:selection}),_this.mode=ViewPortConst.MODE_RUBER_BAND_MOVE},_this.doRubberMouseDown=function(e,mode,item){e.stopPropagation(),_this.setDraggingPosition(e),_this.setState({dragging:!0}),_this.mode=mode},_this.doMouseMove=function(e){if(_this.state.dragging){console.log("Moving"),e.stopPropagation();var coor=_this.adjustCoor(e.clientX,e.clientY),x=coor.x,y=coor.y,deltaX=_this.draggingPositionX-x,deltaY=_this.draggingPositionY-y;switch(_this.mode){case ViewPortConst.MODE_GLOBAL_PAN:_this.pan(deltaX,deltaY);break;case ViewPortConst.MODE_RUBER_BAND_MOVE:_this.updateSelectedItem(helpers_SpacialHelper.moveObject(deltaX,deltaY,_this.state));break;case ViewPortConst.MODE_RUBER_BAND_ROTATE:_this.updateSelectedItem(helpers_SpacialHelper.rotateObject(x,y,_this.draggingPositionX,_this.draggingPositionY,_this.state));break;case ViewPortConst.MODE_RUBER_BAND_RESIZE_UL:case ViewPortConst.MODE_RUBER_BAND_RESIZE_UR:case ViewPortConst.MODE_RUBER_BAND_RESIZE_DL:case ViewPortConst.MODE_RUBER_BAND_RESIZE_DR:var newState=helpers_SpacialHelper.resizeObject(deltaX,deltaY,_this.mode,_this.state);_this.updateSelectedItem(newState)}_this.setDraggingPosition(e)}},_this.doMouseUp=function(e){_this.setState({dragging:!1}),_this.state.selection.type==ObjectTypes_TYPE_LINK&&_this.props.onSelectItem&&_this.props.onSelectItem(null,null),_this.props.selectedItem&&_this.props.onChange&&_this.props.onChange(_this.props.selectedItem,{transform:_this.state.selection.matrix.matrixToText(),w:_this.state.selection.box.w,h:_this.state.selection.box.h})},_this.doMouseWheel=function(e){e.preventDefault();var coor=_this.adjustCoor(e.clientX,e.clientY),cx=coor.x,cy=coor.y,scale=e.deltaY>0?1.05:.95;_this.zoom(scale,cx,cy)},_this.onDragOver=function(e){e.preventDefault()},_this.onDrop=function(e){},_this.addItem=function(e,parent,matrix){var type=parseInt(e.dataTransfer.getData("type")),subtype=e.dataTransfer.getData("subtype"),objType=parseInt(e.dataTransfer.getData("objtype")),data={name:e.dataTransfer.getData("name"),type:type,objType:objType,subtype:subtype,transform:matrix},onAddItem=_this.props.onAddItem;onAddItem&&onAddItem(data,parent)},_this.updateSelectedItem=function(newState){var matrix=newState.matrix,box=newState.box?newState.box:_this.state.selection.box,selection=__assign({},_this.state.selection);selection.matrix=matrix,selection.transform=matrix.matrixToText(),selection.box=box,_this.setState({box:box,selection:selection})},_this.pan=function(dx,dy){_this.zoomPanHelper.pan(dx,dy,_this.state.viewportMtx),_this.applyMatrix()},_this.zoom=function(scale,cx,cy){_this.zoomPanHelper.zoom(scale,cx,cy,_this.state.viewportMtx),_this.applyMatrix()},_this.applyMatrix=function(){var newMatrix=_this.state.viewportMtx.matrixToText();_this.setState({viewportTr:newMatrix})},_this.setDraggingPosition=function(e){var container=_this.refs.container;_this.draggingPositionX=e.clientX-container.offsetLeft,_this.draggingPositionY=e.clientY-container.offsetTop},_this.renderChildren=function(){var selection=_this.state.selection,children=_this.props.children;return null==children?null:(console.log(children),children.map((function(item,i){console.log(item.id),console.log("s:"+selection.id+"  id:"+i+" ");var transform=selection.id==i?selection.transform:null,box=selection.id==i?selection.box:null;return console.log(box),react_default.a.createElement(HOCElement_ViewPortElement,{id:i,key:i,transform:transform,box:box,doObjectMouseDown:_this.doObjectMouseDown},item)})))},_this.zoomPanHelper=new helpers_ZoomPanHelper,_this.state={dragging:!1,viewportMtx:new helpers_Matrix(_this.props.viewportMtx),viewportTr:"1,0,0,1,0,0",selection:_this.getSelectedObjInfo(null)},_this.draggingPositionX=0,_this.draggingPositionY=0,_this.mode=ViewPortConst.MODE_GLOBAL_PAN,_this}return ZoomPan_extends(ZoomPan,_super),ZoomPan.prototype.shouldComponentUpdate=function(nextProps,nextState){return nextState.dragging!==this.state.dragging&&this.addRemoveMouseListener(nextState,this.state),nextProps.selectedItem!==this.props.selectedItem&&(nextState.selection=this.getSelectedObjInfo(nextProps.selectedItem)),!0},ZoomPan.prototype.adjustCoor=function(x,y){var container=this.refs.container;return{x:x-container.offsetLeft,y:y-container.offsetTop}},ZoomPan.prototype.ownEvent=function(e){e.preventDefault(),e.stopPropagation()},ZoomPan.prototype.getObjType=function(item){return item.hasOwnProperty("start")&&item.hasOwnProperty("output")&&item.hasOwnProperty("end")&&item.hasOwnProperty("input")?ObjectTypes_TYPE_LINK:ObjectTypes_TYPE_ITEM},ZoomPan.prototype.render=function(){var viewportTr=this.state.viewportTr;return react_default.a.createElement("div",{ref:"container",className:"zoom-pan-container",onDragOver:this.onDragOver,onDrop:this.onDrop,tabIndex:0},react_default.a.createElement("div",{id:"viewport",ref:"mainSvg",style:{position:"relative",userSelect:"none",height:"100%"},onMouseDown:this.doGlobalMouseDown,onWheel:this.doMouseWheel},react_default.a.createElement("div",{style:{transform:"matrix("+viewportTr+")",position:"absolute"}},this.renderChildren()),react_default.a.createElement(ZoomPan_rubberBand_RubberBand,{selection:this.selection,viewport:this.state,doRubberMouseDown:this.doRubberMouseDown})))},ZoomPan}(react.Component);__webpack_exports__.a=ZoomPan_ZoomPan_ZoomPan},312:function(module,exports,__webpack_require__){__webpack_require__(313),__webpack_require__(519),module.exports=__webpack_require__(520)},430:function(module,exports){},520:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(111);module._StorybookPreserveDecorators=!0,Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)([__webpack_require__(710)],module)}.call(this,__webpack_require__(251)(module))},710:function(module,exports,__webpack_require__){var map={"./components/ZoomPan/ZoomPan.stories.tsx":711};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=710},711:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),_storybook_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(111),_ZoomPan__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(311);Object(_storybook_react__WEBPACK_IMPORTED_MODULE_1__.storiesOf)("ZoomPan",module).add("Default",(function(){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{style:{width:1e3,height:500,backgroundColor:"grey"}},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_ZoomPan__WEBPACK_IMPORTED_MODULE_2__.a,null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null,"ddd"),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null,"ddd2")))}))}.call(this,__webpack_require__(251)(module))},712:function(module,exports,__webpack_require__){var api=__webpack_require__(309),content=__webpack_require__(713);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1},exported=(api(content,options),content.locals?content.locals:{});module.exports=exported},713:function(module,exports,__webpack_require__){(exports=__webpack_require__(310)(!1)).push([module.i,".rubberBand-Container{\n    pointer-events:none;\n    position:absolute;\n}\n.rubberBand{\n    fill:none;\n    pointer-events:none;\n    stroke:rgb(238, 99, 243);\n    stroke-width:1;\n    fill-opacity:0.0;\n    stroke-opacity:1;\n    stroke-dasharray:2\n}\n\n.rubberBandHandle{\n    fill:white;\n    pointer-events:fill;\n    stroke:#ee63f3;\n    stroke-width:1;\n    fill-opacity:1;\n    stroke-opacity:0.9;\n}\n\n.rubberConnector{\n    pointer-events:fill;\n    fill:white;\n    stroke:#ee63f3;\n    stroke-width:1;\n    fill-opacity:1;\n    stroke-opacity:0.9;\n}",""]),module.exports=exports},714:function(module,exports,__webpack_require__){var api=__webpack_require__(309),content=__webpack_require__(715);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1},exported=(api(content,options),content.locals?content.locals:{});module.exports=exported},715:function(module,exports,__webpack_require__){(exports=__webpack_require__(310)(!1)).push([module.i,".zoom-pan-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  outline: 0;\n  overflow: hidden;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n",""]),module.exports=exports}},[[312,1,2]]]);
//# sourceMappingURL=main.15952a2d3bde7f8c7c3c.bundle.js.map